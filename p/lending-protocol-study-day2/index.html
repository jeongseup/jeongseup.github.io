<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Compound V2 CToken ìƒì† êµ¬ì¡°ì™€ Fresh íŒ¨í„´, 3ê°€ì§€ ë Œë”© ëª¨ë¸ ìœ í˜• ë¶„ì„, Aave V3 ë¹„íŠ¸ë§µ ìŠ¤í† ë¦¬ì§€ ìµœì í™”ê¹Œì§€."><title>Lending Protocol Study Day 2: Compound V2 Deep Diveì™€ Aave V3 ì•„í‚¤í…ì²˜</title><link rel=canonical href=https://jeongseup.github.io/p/lending-protocol-study-day2/><link rel=stylesheet href=/scss/style.min.86591c898bd806857815fbb8c47e8d3fed97c133b78e83d9bfc27b164dd0aa2b.css><meta property='og:title' content="Lending Protocol Study Day 2: Compound V2 Deep Diveì™€ Aave V3 ì•„í‚¤í…ì²˜"><meta property='og:description' content="Compound V2 CToken ìƒì† êµ¬ì¡°ì™€ Fresh íŒ¨í„´, 3ê°€ì§€ ë Œë”© ëª¨ë¸ ìœ í˜• ë¶„ì„, Aave V3 ë¹„íŠ¸ë§µ ìŠ¤í† ë¦¬ì§€ ìµœì í™”ê¹Œì§€."><meta property='og:url' content='https://jeongseup.github.io/p/lending-protocol-study-day2/'><meta property='og:site_name' content='Jeongseup Blog'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='DeFi'><meta property='article:tag' content='Lending'><meta property='article:tag' content='Compound'><meta property='article:tag' content='Aave'><meta property='article:tag' content='Solidity'><meta property='article:tag' content='Smart Contract'><meta property='article:published_time' content='2026-02-25T00:00:00+00:00'><meta property='article:modified_time' content='2026-02-25T00:00:00+00:00'><meta name=twitter:site content="@@jeongseup"><meta name=twitter:creator content="@@jeongseup"><meta name=twitter:title content="Lending Protocol Study Day 2: Compound V2 Deep Diveì™€ Aave V3 ì•„í‚¤í…ì²˜"><meta name=twitter:description content="Compound V2 CToken ìƒì† êµ¬ì¡°ì™€ Fresh íŒ¨í„´, 3ê°€ì§€ ë Œë”© ëª¨ë¸ ìœ í˜• ë¶„ì„, Aave V3 ë¹„íŠ¸ë§µ ìŠ¤í† ë¦¬ì§€ ìµœì í™”ê¹Œì§€."><link rel="shortcut icon" href=/favicon.png><script async src="https://www.googletagmanager.com/gtag/js?id=G-H52JV5SRGP"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-H52JV5SRGP")</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_4265f78095175e3e.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ‘¨â€ğŸ’»</span></figure><div class=site-meta><h1 class=site-name><a href=/>Jeongseup Blog</a></h1><h2 class=site-description>Software Engineer (DevOps & Solution Engineer)</h2></div></header><ol class=menu-social><li><a href=https://warpcast.com/cosmoseup target=_blank title=Farcaster rel=me><svg class="icon icon-tabler icon-tabler-cube" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M21 16.008V7.99a1.98 1.98.0 00-1-1.717l-7-4.008a2.016 2.016.0 00-2 0L4 6.273c-.619.355-1 1.01-1 1.718v8.018c0 .709.381 1.363 1 1.717l7 4.008a2.016 2.016.0 002 0l7-4.008c.619-.355 1-1.01 1-1.718z"/><path d="M12 22V12"/><path d="M12 12l8.73-5.04"/><path d="M3.27 6.96 12 12"/></svg></a></li><li><a href=https://github.com/jeongseup/ target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/jeongseup/ target=_blank title=LinkedIn rel=me><svg class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li><li><a href=https://medium.com/@jeongseup target=_blank title=Medium rel=me><svg class="icon icon-tabler icon-tabler-brand-medium" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 9h1l3 3 3-3h1"/><path d="M8 15h2"/><path d="M14 15h2"/><path d="M9 9v6"/><path d="M15 9v6"/></svg></a></li><li><a href=https://t.me/jeongseup target=_blank title=Telegram rel=me><svg class="icon icon-tabler icon-tabler-brand-telegram" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 10l-4 4 6 6 4-16-18 7 4 2 2 6 3-4"/></svg></a></li><li><a href=https://x.com/jeongseup target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4l11.733 16H20L8.267 4z"/><path d="M4 20l6.768-6.768m2.46-2.46L20 4"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 7a4 4 0 108 0A4 4 0 008 7"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/project/><svg class="icon icon-tabler icon-tabler-code" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 8l-4 4 4 4"/><path d="M17 8l4 4-4 4"/><path d="M14 4l-4 16"/></svg>
<span>Projects</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/contribution/><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg>
<span>Open Source</span></a></li><li><a href=/research/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="M7 9a2 2 0 104 0A2 2 0 107 9"/><path d="M17 7a2 2 0 104 0 2 2 0 10-4 0"/><path d="M12 15a2 2 0 104 0 2 2 0 10-4 0"/><path d="M10.16 10.62l2.34 2.88"/><path d="M15.088 13.328l2.837-4.586"/></svg>
<span>Technical Research</span></a></li><li><a href=/contact/><svg class="icon icon-tabler icon-tabler-mail" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/><path d="M3 7l9 6 9-6"/></svg>
<span>Contact Me</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#day-2-ëª©í‘œ>Day 2 ëª©í‘œ</a></li><li><a href=#compound-v2-deep-dive-ctoken-ìƒì†-êµ¬ì¡°>Compound V2 Deep Dive: CToken ìƒì† êµ¬ì¡°</a></li><li><a href=#fresh-íŒ¨í„´-ì´ìë¶€í„°-ì •ì‚°í•˜ê³ -ë³¸ë¡ ìœ¼ë¡œ>Fresh íŒ¨í„´: &ldquo;ì´ìë¶€í„° ì •ì‚°í•˜ê³  ë³¸ë¡ ìœ¼ë¡œ&rdquo;</a></li><li><a href=#mantissa-solidityì˜-ì†Œìˆ˜ì -í•´ë²•>Mantissa: Solidityì˜ ì†Œìˆ˜ì  í•´ë²•</a></li><li><a href=#lazy-interest-accrual-ì´ìëŠ”-í•„ìš”í• -ë•Œë§Œ-ê³„ì‚°í•œë‹¤>Lazy Interest Accrual: ì´ìëŠ” &ldquo;í•„ìš”í•  ë•Œë§Œ&rdquo; ê³„ì‚°í•œë‹¤</a></li><li><a href=#ì´ì-ì‹œë‚˜ë¦¬ì˜¤-ì‹œë®¬ë ˆì´ì…˜>ì´ì ì‹œë‚˜ë¦¬ì˜¤ ì‹œë®¬ë ˆì´ì…˜</a><ol><li><a href=#ì´ˆê¸°-ìƒíƒœ>ì´ˆê¸° ìƒíƒœ</a></li><li><a href=#aliceê°€-1000-usdc-ëŒ€ì¶œ>Aliceê°€ 1,000 USDC ëŒ€ì¶œ</a></li><li><a href=#100ë¸”ë¡-í›„-ì´ì-ì •ì‚°>100ë¸”ë¡ í›„ ì´ì ì •ì‚°</a></li></ol></li><li><a href=#ë Œë”©-í”„ë¡œí† ì½œì˜-3ê°€ì§€-ìœ í˜•>ë Œë”© í”„ë¡œí† ì½œì˜ 3ê°€ì§€ ìœ í˜•</a><ol><li><a href=#1-pool-based-compound-aave>1. Pool-based (Compound, Aave)</a></li><li><a href=#2-cdp-based-makerdao>2. CDP-based (MakerDAO)</a></li><li><a href=#3-fixed-rate-yield-protocol>3. Fixed-rate (Yield Protocol)</a></li><li><a href=#ë¹„êµ-ì •ë¦¬>ë¹„êµ ì •ë¦¬</a></li></ol></li><li><a href=#aave-v3-ì•„í‚¤í…ì²˜-compoundì—ì„œ-ë¬´ì—‡ì´-ì§„í™”í–ˆë‚˜>Aave V3 ì•„í‚¤í…ì²˜: Compoundì—ì„œ ë¬´ì—‡ì´ ì§„í™”í–ˆë‚˜</a><ol><li><a href=#delegatecall--library-íŒ¨í„´>delegatecall + Library íŒ¨í„´</a></li><li><a href=#debt-tokenization>Debt Tokenization</a></li></ol></li><li><a href=#ë¹„íŠ¸ë§µ-ìŠ¤í† ë¦¬ì§€-ìµœì í™”>ë¹„íŠ¸ë§µ ìŠ¤í† ë¦¬ì§€ ìµœì í™”</a><ol><li><a href=#compound-v2-ë°°ì—´-ìˆœíšŒ>Compound V2: ë°°ì—´ ìˆœíšŒ</a></li><li><a href=#aave-v3-ë¹„íŠ¸ë§µ>Aave V3: ë¹„íŠ¸ë§µ</a></li><li><a href=#ì„±ëŠ¥-ë¹„êµ>ì„±ëŠ¥ ë¹„êµ</a></li></ol></li><li><a href=#lendingpool-ë¦¬íŒ©í† ë§-ë°°ìš´-ê²ƒì„-ì ìš©í•˜ê¸°>LendingPool ë¦¬íŒ©í† ë§: ë°°ìš´ ê²ƒì„ ì ìš©í•˜ê¸°</a><ol><li><a href=#before-ë‹¨ìˆœ-ë§¤í•‘>Before: ë‹¨ìˆœ ë§¤í•‘</a></li><li><a href=#after-êµ¬ì¡°í™”ëœ-ìŠ¤í† ë¦¬ì§€>After: êµ¬ì¡°í™”ëœ ìŠ¤í† ë¦¬ì§€</a></li></ol></li><li><a href=#jumpratemodel-í…ŒìŠ¤íŠ¸-fuzz-testingê¹Œì§€>JumpRateModel í…ŒìŠ¤íŠ¸: Fuzz Testingê¹Œì§€</a><ol><li><a href=#unit-test-18ê°œ-ì¼€ì´ìŠ¤>Unit Test: 18ê°œ ì¼€ì´ìŠ¤</a></li><li><a href=#fuzz-test-6ê°œ-ì¼€ì´ìŠ¤>Fuzz Test: 6ê°œ ì¼€ì´ìŠ¤</a></li></ol></li><li><a href=#day-2-í•µì‹¬-ì¸ì‚¬ì´íŠ¸-ì •ë¦¬>Day 2 í•µì‹¬ ì¸ì‚¬ì´íŠ¸ ì •ë¦¬</a></li><li><a href=#next-day-3>Next: Day 3</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/technical-research/ style=background-color:#8b5cf6;color:#fff>Technical Research</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/lending-protocol-study-day2/>Lending Protocol Study Day 2: Compound V2 Deep Diveì™€ Aave V3 ì•„í‚¤í…ì²˜</a></h2><h3 class=article-subtitle>Compound V2 CToken ìƒì† êµ¬ì¡°ì™€ Fresh íŒ¨í„´, 3ê°€ì§€ ë Œë”© ëª¨ë¸ ìœ í˜• ë¶„ì„, Aave V3 ë¹„íŠ¸ë§µ ìŠ¤í† ë¦¬ì§€ ìµœì í™”ê¹Œì§€.</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2026-02-25T00:00:00Z>Feb 25, 2026</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>9 minute read</time></div></footer></div></header><section class=article-content><blockquote><p>7ì¼ê°„ì˜ DeFi Lending Protocol ìŠ¤í„°ë”” ì‹œë¦¬ì¦ˆ. Day 2ì—ì„œëŠ” Compound V2ì˜ ë‚´ë¶€ êµ¬ì¡°ë¥¼ ì½”ë“œ ë ˆë²¨ë¡œ íŒŒê³ ë“¤ê³ , ë Œë”© í”„ë¡œí† ì½œì˜ 3ê°€ì§€ ìœ í˜•ì„ ë¶„ë¥˜í•œ ë’¤, Aave V3ì˜ ì•„í‚¤í…ì²˜ ì§„í™”ë¥¼ ë¶„ì„í•œë‹¤.</p><p><strong>Repository:</strong> <a class=link href=https://github.com/jeongseup/lending-protocol-study target=_blank rel=noopener>jeongseup/lending-protocol-study</a></p></blockquote><hr><h2 id=day-2-ëª©í‘œ>Day 2 ëª©í‘œ</h2><ul><li>Compound V2ì˜ CToken ìƒì† êµ¬ì¡°ì™€ <strong>&ldquo;Fresh&rdquo; íŒ¨í„´</strong>ì„ ì½”ë“œ ë ˆë²¨ë¡œ ì´í•´í•œë‹¤</li><li><strong>Mantissa</strong> ê¸°ë°˜ ê³ ì •ì†Œìˆ˜ì  ì—°ì‚°ê³¼ <strong>Lazy Interest Accrual</strong> ë©”ì»¤ë‹ˆì¦˜ì„ íŒŒì•…í•œë‹¤</li><li>ë Œë”© í”„ë¡œí† ì½œì„ <strong>3ê°€ì§€ ìœ í˜•</strong>(Pool-based, CDP-based, Fixed-rate)ìœ¼ë¡œ ë¶„ë¥˜í•œë‹¤</li><li>Aave V3ì˜ <strong>ë¹„íŠ¸ë§µ ìŠ¤í† ë¦¬ì§€ ìµœì í™”</strong>ì™€ ì•„í‚¤í…ì²˜ ì§„í™”ë¥¼ ë¶„ì„í•œë‹¤</li></ul><hr><h2 id=compound-v2-deep-dive-ctoken-ìƒì†-êµ¬ì¡°>Compound V2 Deep Dive: CToken ìƒì† êµ¬ì¡°</h2><p>Day 1ì—ì„œ Compound V2ì˜ í•µì‹¬ íŒŒì¼ 3ê°œë¥¼ ì–¸ê¸‰í–ˆë‹¤. Day 2ì—ì„œëŠ” CTokenì˜ <strong>ìƒì† êµ¬ì¡°</strong>ë¶€í„° íŒŒê³ ë“ ë‹¤.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>CTokenInterface (ì¸í„°í˜ì´ìŠ¤)
</span></span><span class=line><span class=cl>  â””â”€ CToken (í•µì‹¬ ë¡œì§)
</span></span><span class=line><span class=cl>       â”œâ”€ CErc20 (ERC20 ìì‚°ìš© - USDC, DAI ë“±)
</span></span><span class=line><span class=cl>       â””â”€ CEther (ETH ì „ìš©)
</span></span></code></pre></td></tr></table></div></div><p><code>CErc20</code>ê³¼ <code>CEther</code>ì˜ ì°¨ì´ëŠ” ë‹¨ìˆœí•˜ë‹¤. ETHëŠ” ERC20ì´ ì•„ë‹ˆë¼ <code>msg.value</code>ë¡œ ë°›ì•„ì•¼ í•˜ë¯€ë¡œ, ìê¸ˆ ìˆ˜ìˆ˜ ë¡œì§ë§Œ ë‹¤ë¥´ê³  <strong>í•µì‹¬ ë Œë”© ë¡œì§ì€ CTokenì— ëª¨ë‘ ìˆë‹¤.</strong></p><p>ì¤‘ìš”í•œ ê±´ CTokenì´ <strong>í’€ ì—­í• ê¹Œì§€ ê²¸í•œë‹¤</strong>ëŠ” ì ì´ë‹¤. <code>mint()</code>, <code>borrow()</code>, <code>repay()</code>, <code>liquidate()</code> ëª¨ë‘ CToken ì»¨íŠ¸ë™íŠ¸ì— ìˆë‹¤. í•˜ë‚˜ì˜ ì»¨íŠ¸ë™íŠ¸ê°€ ERC20 í† í°ì´ë©´ì„œ ë™ì‹œì— ë Œë”© í’€ì¸ <strong>Monolithic êµ¬ì¡°</strong>ë‹¤.</p><hr><h2 id=fresh-íŒ¨í„´-ì´ìë¶€í„°-ì •ì‚°í•˜ê³ -ë³¸ë¡ ìœ¼ë¡œ>Fresh íŒ¨í„´: &ldquo;ì´ìë¶€í„° ì •ì‚°í•˜ê³  ë³¸ë¡ ìœ¼ë¡œ&rdquo;</h2><p>Compound V2ì˜ ëª¨ë“  í•µì‹¬ í•¨ìˆ˜ ì´ë¦„ì— <code>Fresh</code>ê°€ ë¶™ì–´ ìˆë‹¤.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=kd>function</span> <span class=nf>mintFresh</span><span class=p>(</span><span class=kt>address</span> <span class=n>minter</span><span class=p>,</span> <span class=kt>uint</span> <span class=n>mintAmount</span><span class=p>)</span> <span class=k>internal</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nf>borrowFresh</span><span class=p>(</span><span class=kt>address</span> <span class=k>payable</span> <span class=n>borrower</span><span class=p>,</span> <span class=kt>uint</span> <span class=n>borrowAmount</span><span class=p>)</span> <span class=k>internal</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nf>repayBorrowFresh</span><span class=p>(</span><span class=kt>address</span> <span class=n>payer</span><span class=p>,</span> <span class=kt>address</span> <span class=n>borrower</span><span class=p>,</span> <span class=kt>uint</span> <span class=n>repayAmount</span><span class=p>)</span> <span class=k>internal</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nf>liquidateBorrowFresh</span><span class=p>(</span><span class=kt>address</span> <span class=n>liquidator</span><span class=p>,</span> <span class=kt>address</span> <span class=n>borrower</span><span class=p>,</span> <span class=p>...)</span> <span class=k>internal</span>
</span></span></code></pre></td></tr></table></div></div><p>ì™œ <code>Fresh</code>ì¼ê¹Œ? **&ldquo;ì´ìë¥¼ ìµœì‹  ìƒíƒœë¡œ ì •ì‚°í•œ ë’¤ì— í•µì‹¬ ë¡œì§ì„ ì‹¤í–‰í•œë‹¤&rdquo;**ëŠ” íŒ¨í„´ì´ë‹¤.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=kd>function</span> <span class=nf>mint</span><span class=p>(</span><span class=kt>uint</span> <span class=n>mintAmount</span><span class=p>)</span> <span class=k>external</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>uint</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>accrueInterest</span><span class=p>();</span>       <span class=c1>// 1. ì´ì ë¨¼ì € ì •ì‚°
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=n>mintFresh</span><span class=p>(</span><span class=nb>msg</span><span class=p>.</span><span class=nb>sender</span><span class=p>,</span> <span class=n>mintAmount</span><span class=p>);</span>  <span class=c1>// 2. ê·¸ ë‹¤ìŒ ë³¸ë¡ 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ëª¨ë“  external í•¨ìˆ˜ê°€ ì´ íŒ¨í„´ì„ ë”°ë¥¸ë‹¤:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ì‚¬ìš©ì í˜¸ì¶œ â†’ accrueInterest() â†’ xxxFresh() â†’ ì‹¤ì œ ë¡œì§
</span></span></code></pre></td></tr></table></div></div><p>ì´ë ‡ê²Œ í•˜ëŠ” ì´ìœ ëŠ” ê°„ë‹¨í•˜ë‹¤. ì´ì ê³„ì‚°ì€ <strong>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì´í›„ì˜ ë¸”ë¡ ìˆ˜</strong>ì— ê¸°ë°˜í•œë‹¤. ì´ìë¥¼ ì •ì‚°í•˜ì§€ ì•Šê³  <code>mint()</code>ì„ ì‹¤í–‰í•˜ë©´, ê¸°ì¡´ ì˜ˆì¹˜ìë“¤ì˜ êµí™˜ë¹„ìœ¨ì´ ë¶€ì •í™•í•œ ìƒíƒœì—ì„œ ìƒˆë¡œìš´ ì§€ë¶„ì´ ë°œí–‰ë˜ì–´ <strong>ê¸°ì¡´ ì˜ˆì¹˜ìê°€ ì†í•´ë¥¼ ë³¸ë‹¤.</strong></p><hr><h2 id=mantissa-solidityì˜-ì†Œìˆ˜ì -í•´ë²•>Mantissa: Solidityì˜ ì†Œìˆ˜ì  í•´ë²•</h2><p>Solidityì—ëŠ” ë¶€ë™ì†Œìˆ˜ì ì´ ì—†ë‹¤. Compound V2ëŠ” ì´ë¥¼ <strong>Mantissa</strong> ë°©ì‹ìœ¼ë¡œ í•´ê²°í•œë‹¤.</p>$$\text{Mantissa} = \text{ì‹¤ì œê°’} \times 10^{18}$$<p>ì˜ˆë¥¼ ë“¤ì–´:</p><ul><li>ì´ììœ¨ 5% â†’ <code>0.05 Ã— 10^18 = 50000000000000000</code></li><li>êµí™˜ë¹„ìœ¨ 0.02 â†’ <code>0.02 Ã— 10^18 = 20000000000000000</code></li></ul><p>ê³±ì…ˆê³¼ ë‚˜ëˆ—ì…ˆ ì‹œ ìŠ¤ì¼€ì¼ë§ì„ ë§ì¶°ì•¼ í•œë‹¤:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=c1>// ë‘ Mantissa ê°’ì˜ ê³±ì…ˆ: ê²°ê³¼ë¥¼ 10^18ìœ¼ë¡œ ë‚˜ëˆ ì„œ ìŠ¤ì¼€ì¼ ë³µì›
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nf>mulScalar</span><span class=p>(</span><span class=n>Exp</span> <span class=k>memory</span> <span class=n>a</span><span class=p>,</span> <span class=kt>uint</span> <span class=n>scalar</span><span class=p>)</span> <span class=k>pure</span> <span class=k>internal</span> <span class=k>returns</span> <span class=p>(</span><span class=n>Exp</span> <span class=k>memory</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Exp</span><span class=p>({</span><span class=n>mantissa</span><span class=o>:</span> <span class=n>a</span><span class=p>.</span><span class=n>mantissa</span> <span class=o>*</span> <span class=n>scalar</span><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nf>mulExp</span><span class=p>(</span><span class=n>Exp</span> <span class=k>memory</span> <span class=n>a</span><span class=p>,</span> <span class=n>Exp</span> <span class=k>memory</span> <span class=n>b</span><span class=p>)</span> <span class=k>pure</span> <span class=k>internal</span> <span class=k>returns</span> <span class=p>(</span><span class=n>Exp</span> <span class=k>memory</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Exp</span><span class=p>({</span><span class=n>mantissa</span><span class=o>:</span> <span class=n>a</span><span class=p>.</span><span class=n>mantissa</span> <span class=o>*</span> <span class=n>b</span><span class=p>.</span><span class=n>mantissa</span> <span class=o>/</span> <span class=mi>1</span><span class=n>e18</span><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ì´ íŒ¨í„´ì€ Compoundë§Œì˜ ê²ƒì´ ì•„ë‹ˆë‹¤. Aaveì˜ <code>RAY(10^27)</code>, Uniswap V3ì˜ <code>Q96(2^96)</code>, MakerDAOì˜ <code>WAD(10^18)</code> ëª¨ë‘ ê°™ì€ ì›ë¦¬ë‹¤. <strong>ì •ìˆ˜ë¡œ ì†Œìˆ˜ì ì„ í‘œí˜„í•˜ê¸° ìœ„í•œ ê³ ì •ì†Œìˆ˜ì  ì—°ì‚°.</strong></p><hr><h2 id=lazy-interest-accrual-ì´ìëŠ”-í•„ìš”í• -ë•Œë§Œ-ê³„ì‚°í•œë‹¤>Lazy Interest Accrual: ì´ìëŠ” &ldquo;í•„ìš”í•  ë•Œë§Œ&rdquo; ê³„ì‚°í•œë‹¤</h2><p><code>accrueInterest()</code>ëŠ” ë§¤ ë¸”ë¡ë§ˆë‹¤ ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ê²Œ ì•„ë‹ˆë‹¤. <strong>ëˆ„êµ°ê°€ íŠ¸ëœì­ì…˜ì„ ë³´ë‚¼ ë•Œë§Œ</strong> ì‹¤í–‰ëœë‹¤. ì´ê²ƒì´ <strong>Lazy Evaluation</strong>ì´ë‹¤.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ë¸”ë¡ 100: Aliceê°€ mint()     â†’ accrueInterest() ì‹¤í–‰ (ë¸”ë¡ 0~100 ì´ì ê³„ì‚°)
</span></span><span class=line><span class=cl>ë¸”ë¡ 200: ì•„ë¬´ ì¼ ì—†ìŒ        â†’ ì´ì ê³„ì‚° ì•ˆ í•¨
</span></span><span class=line><span class=cl>ë¸”ë¡ 300: Bobì´ borrow()      â†’ accrueInterest() ì‹¤í–‰ (ë¸”ë¡ 100~300 ì´ì ê³„ì‚°)
</span></span></code></pre></td></tr></table></div></div><p>200 ë¸”ë¡ ë™ì•ˆ ì•„ë¬´ë„ ìƒí˜¸ì‘ìš©í•˜ì§€ ì•Šìœ¼ë©´, 200 ë¸”ë¡ì¹˜ì˜ ì´ìê°€ í•œë²ˆì— ê³„ì‚°ëœë‹¤. ê°€ìŠ¤ë¹„ëŠ” <strong>íŠ¸ëœì­ì…˜ ìˆ˜ê°€ ì•„ë‹ˆë¼ ìƒí˜¸ì‘ìš© ë¹ˆë„ì— ë¹„ë¡€</strong>í•œë‹¤.</p><p><code>accrueInterest()</code>ê°€ ì—…ë°ì´íŠ¸í•˜ëŠ” ìƒíƒœ ë³€ìˆ˜ëŠ” ë”± <strong>4ê°œ</strong>ë‹¤:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=n>totalBorrows</span>    <span class=c1>// ì´ ëŒ€ì¶œëŸ‰ (ì´ì í¬í•¨)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>totalReserves</span>   <span class=c1>// í”„ë¡œí† ì½œ ìˆ˜ìµ ëˆ„ì 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>borrowIndex</span>     <span class=c1>// ëŒ€ì¶œì ì´ì ì¶”ì ìš© ì „ì—­ ì¸ë±ìŠ¤
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>accrualBlockNumber</span>  <span class=c1>// ë§ˆì§€ë§‰ ì´ì ì •ì‚° ë¸”ë¡ ë²ˆí˜¸
</span></span></span></code></pre></td></tr></table></div></div><p>4ê°œì˜ <code>SSTORE</code> = 20,000 gas. ì‚¬ìš©ì ìˆ˜ê°€ ì•„ë¬´ë¦¬ ë§ì•„ë„ ì´ ë¹„ìš©ì€ ê³ ì •ì´ë‹¤. ì´ê²ƒì´ Day 1ì—ì„œ ì„¤ëª…í•œ <strong>Scaled Balance íŒ¨í„´</strong>ì˜ ì‹¤ì œ êµ¬í˜„ì´ë‹¤.</p><hr><h2 id=ì´ì-ì‹œë‚˜ë¦¬ì˜¤-ì‹œë®¬ë ˆì´ì…˜>ì´ì ì‹œë‚˜ë¦¬ì˜¤ ì‹œë®¬ë ˆì´ì…˜</h2><p>êµ¬ì²´ì ì¸ ìˆ«ìë¡œ ë”°ë¼ê°€ë³´ì.</p><h3 id=ì´ˆê¸°-ìƒíƒœ>ì´ˆê¸° ìƒíƒœ</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ë¸”ë¡ 0: Poolì— 10,000 USDC
</span></span><span class=line><span class=cl>- totalCash = 10,000
</span></span><span class=line><span class=cl>- totalBorrows = 0
</span></span><span class=line><span class=cl>- totalReserves = 0
</span></span><span class=line><span class=cl>- borrowIndex = 1.0 (1e18)
</span></span><span class=line><span class=cl>- exchangeRate = 10,000 / 500,000 = 0.02 (cToken 500,000ê°œ ë°œí–‰ ê°€ì •)
</span></span></code></pre></td></tr></table></div></div><h3 id=aliceê°€-1000-usdc-ëŒ€ì¶œ>Aliceê°€ 1,000 USDC ëŒ€ì¶œ</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ë¸”ë¡ 100: Alice borrow(1,000)
</span></span><span class=line><span class=cl>- accrueInterest() ì‹¤í–‰ (totalBorrows = 0ì´ë¯€ë¡œ ì´ì ì—†ìŒ)
</span></span><span class=line><span class=cl>- totalCash = 9,000 (1,000 ë¹ ì§)
</span></span><span class=line><span class=cl>- totalBorrows = 1,000
</span></span><span class=line><span class=cl>- Aliceì˜ borrowSnapshot = {principal: 1,000, interestIndex: 1.0}
</span></span></code></pre></td></tr></table></div></div><h3 id=100ë¸”ë¡-í›„-ì´ì-ì •ì‚°>100ë¸”ë¡ í›„ ì´ì ì •ì‚°</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ë¸”ë¡ 200: Bobì´ mint() í˜¸ì¶œ
</span></span><span class=line><span class=cl>- ì´ììœ¨: borrowRate = 0.0001/ë¸”ë¡ (ì—° ì•½ 5.3%)
</span></span><span class=line><span class=cl>- ê²½ê³¼ ë¸”ë¡: 100
</span></span><span class=line><span class=cl>- simpleInterestFactor = 0.0001 Ã— 100 = 0.01
</span></span><span class=line><span class=cl>- ìƒˆ totalBorrows = 1,000 Ã— 1.01 = 1,010
</span></span><span class=line><span class=cl>- Reserve Factor 10%: ìƒˆ totalReserves = 10 Ã— 0.1 = 1
</span></span><span class=line><span class=cl>- ìƒˆ borrowIndex = 1.0 Ã— 1.01 = 1.01
</span></span></code></pre></td></tr></table></div></div><p>Aliceì˜ ì‹¤ì œ ëŒ€ì¶œ ì”ì•¡ì€?</p>$$\text{Alice ëŒ€ì¶œì”ì•¡} = \frac{\text{principal} \times \text{í˜„ì¬ borrowIndex}}{\text{Aliceì˜ interestIndex}} = \frac{1{,}000 \times 1.01}{1.0} = 1{,}010 \text{ USDC}$$<p>Aliceì˜ Storageë¥¼ ê±´ë“œë¦¬ì§€ ì•Šê³ ë„ <strong>ì „ì—­ borrowIndex í•˜ë‚˜ë§Œìœ¼ë¡œ</strong> ì •í™•í•œ ì”ì•¡ì„ ê³„ì‚°í–ˆë‹¤.</p><hr><h2 id=ë Œë”©-í”„ë¡œí† ì½œì˜-3ê°€ì§€-ìœ í˜•>ë Œë”© í”„ë¡œí† ì½œì˜ 3ê°€ì§€ ìœ í˜•</h2><p>Day 1ì—ì„œëŠ” Pool-based ëª¨ë¸ë§Œ ë‹¤ë¤˜ë‹¤. ì‹¤ì œë¡œ ë Œë”© í”„ë¡œí† ì½œì€ <strong>ìê¸ˆ ì¡°ë‹¬ ë°©ì‹</strong>ì— ë”°ë¼ 3ê°€ì§€ë¡œ ë¶„ë¥˜ëœë‹¤.</p><h3 id=1-pool-based-compound-aave>1. Pool-based (Compound, Aave)</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ì˜ˆì¹˜ì â†’ [Pool] â†’ ì°¨ì…ì
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>ê¸°ì¡´ ì˜ˆì¹˜ê¸ˆ</strong>ì—ì„œ ëŒ€ì¶œ</li><li>ì˜ˆì¹˜ìê°€ ì—†ìœ¼ë©´ ë¹Œë¦´ ìˆ˜ ì—†ë‹¤</li><li>ì´ììœ¨ì€ Utilization Rateì— ì—°ë™</li></ul><h3 id=2-cdp-based-makerdao>2. CDP-based (MakerDAO)</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ì‚¬ìš©ì â†’ [Vault] â†’ ìƒˆ DAI ë°œí–‰
</span></span></code></pre></td></tr></table></div></div><ul><li>í”„ë¡œí† ì½œì´ <strong>ìƒˆ í† í°ì„ ë°œí–‰</strong> (mint)</li><li>ì˜ˆì¹˜ì ì—†ì´ë„ ëŒ€ì¶œ ê°€ëŠ¥</li><li>Stability Fee(ì´ì)ëŠ” ê±°ë²„ë„ŒìŠ¤ê°€ ê²°ì •</li><li>CDP = Collateralized Debt Position</li></ul><h3 id=3-fixed-rate-yield-protocol>3. Fixed-rate (Yield Protocol)</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ì‚¬ìš©ì â†’ fyToken (ë§Œê¸° ì‹œ 1:1 êµí™˜ ê°€ëŠ¥)
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>í• ì¸ëœ ë¯¸ë˜ ê°€ì¹˜ í† í°</strong> ë§¤ë§¤</li><li>0.95 fyUSDCë¥¼ ì‚¬ë©´, ë§Œê¸°ì— 1 USDC â†’ ì•½ 5% ê³ ì • ê¸ˆë¦¬</li><li>ì´ììœ¨ì´ íŠ¸ë ˆì´ë”©ìœ¼ë¡œ ê²°ì •</li></ul><h3 id=ë¹„êµ-ì •ë¦¬>ë¹„êµ ì •ë¦¬</h3><div class=table-wrapper><table><thead><tr><th>íŠ¹ì„±</th><th>Pool-based</th><th>CDP-based</th><th>Fixed-rate</th></tr></thead><tbody><tr><td>ìê¸ˆ ì¶œì²˜</td><td>ì˜ˆì¹˜ì</td><td>í”„ë¡œí† ì½œ ë°œí–‰</td><td>ì‹œì¥ ë§¤ë§¤</td></tr><tr><td>ì´ììœ¨ ê²°ì •</td><td>ì•Œê³ ë¦¬ì¦˜ (ì‚¬ìš©ë¥ )</td><td>ê±°ë²„ë„ŒìŠ¤ íˆ¬í‘œ</td><td>ì‹œì¥ ìˆ˜ê¸‰</td></tr><tr><td>ë³€ë™/ê³ ì •</td><td>ë³€ë™</td><td>ë°˜ê³ ì •</td><td>ê³ ì •</td></tr><tr><td>ëŒ€í‘œ</td><td>Compound, Aave</td><td>MakerDAO</td><td>Yield, Notional</td></tr><tr><td>í•„ìš” ì¡°ê±´</td><td>ìœ ë™ì„± ê³µê¸‰ì</td><td>ì—†ìŒ (mint)</td><td>ë§Œê¸° ë§¤ì¹­</td></tr></tbody></table></div><p>ëŒ€ë¶€ë¶„ì˜ ë©”ì´ì € í”„ë¡œí† ì½œì´ Pool-basedì¸ ì´ìœ : <strong>êµ¬í˜„ì´ ë‹¨ìˆœí•˜ê³ , ìœ ë™ì„±ì´ ìì—°ìŠ¤ëŸ½ê²Œ í˜•ì„±</strong>ë˜ê¸° ë•Œë¬¸ì´ë‹¤. CDPëŠ” í† í° ê²½ì œ ì„¤ê³„ê°€ ë³µì¡í•˜ê³ , Fixed-rateëŠ” ë§Œê¸° ë§¤ì¹­ì´ ì–´ë µë‹¤.</p><hr><h2 id=aave-v3-ì•„í‚¤í…ì²˜-compoundì—ì„œ-ë¬´ì—‡ì´-ì§„í™”í–ˆë‚˜>Aave V3 ì•„í‚¤í…ì²˜: Compoundì—ì„œ ë¬´ì—‡ì´ ì§„í™”í–ˆë‚˜</h2><p>Compound V2ëŠ” CTokenì´ ëª¨ë“  ê±¸ í•œë‹¤. Aave V3ëŠ” ì´ë¥¼ <strong>ë¶„ë¦¬</strong>í–ˆë‹¤.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Compound V2:
</span></span><span class=line><span class=cl>  ì‚¬ìš©ì â†’ CToken.mint()     (CToken = í’€ + í† í°)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Aave V3:
</span></span><span class=line><span class=cl>  ì‚¬ìš©ì â†’ Pool.supply()     (Pool = ë¼ìš°í„°)
</span></span><span class=line><span class=cl>         â†’ SupplyLogic.executeSupply()  (Library = ì‹¤ì œ ë¡œì§)
</span></span><span class=line><span class=cl>         â†’ aToken.mint()    (aToken = ìˆœìˆ˜ ì˜ìˆ˜ì¦)
</span></span></code></pre></td></tr></table></div></div><h3 id=delegatecall--library-íŒ¨í„´>delegatecall + Library íŒ¨í„´</h3><p>Aave V3ì˜ <code>Pool.sol</code>ì€ ì–‡ì€ í”„ë¡ì‹œì— ê°€ê¹ë‹¤. ì‹¤ì œ ë¡œì§ì€ <strong>Library</strong> ì»¨íŠ¸ë™íŠ¸ì— ìˆë‹¤.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=c1>// Pool.sol
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nf>supply</span><span class=p>(</span><span class=kt>address</span> <span class=n>asset</span><span class=p>,</span> <span class=kt>uint256</span> <span class=n>amount</span><span class=p>,</span> <span class=p>...)</span> <span class=k>external</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>SupplyLogic</span><span class=p>.</span><span class=n>executeSupply</span><span class=p>(...);</span>  <span class=c1>// delegatecallë¡œ Library í˜¸ì¶œ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nf>borrow</span><span class=p>(</span><span class=kt>address</span> <span class=n>asset</span><span class=p>,</span> <span class=kt>uint256</span> <span class=n>amount</span><span class=p>,</span> <span class=p>...)</span> <span class=k>external</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>BorrowLogic</span><span class=p>.</span><span class=n>executeBorrow</span><span class=p>(...);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Libraryë¥¼ ì“°ë©´:</p><ul><li><strong>ì½”ë“œ í¬ê¸° ì œí•œ(24KB)</strong> íšŒí”¼ - Poolì˜ ë¡œì§ì´ ì•„ë¬´ë¦¬ ì»¤ë„ Libraryì— ë¶„ì‚°</li><li><strong>ê´€ì‹¬ì‚¬ ë¶„ë¦¬</strong> - Supply, Borrow, Liquidation ë¡œì§ì´ ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬</li><li>ë‹¨, LibraryëŠ” <strong>ë…ë¦½ ë°°í¬ í›„ ì—…ê·¸ë ˆì´ë“œ ë¶ˆê°€</strong> - Proxy íŒ¨í„´ê³¼ ì¡°í•©í•˜ì—¬ í•´ê²°</li></ul><h3 id=debt-tokenization>Debt Tokenization</h3><p>Compound V2ì—ì„œ ëŒ€ì¶œì€ ë‹¨ìˆœ ë§¤í•‘ì´ë‹¤:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=c1>// Compound V2
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>mapping</span><span class=p>(</span><span class=kt>address</span> <span class=o>=&gt;</span> <span class=n>BorrowSnapshot</span><span class=p>)</span> <span class=n>accountBorrows</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>Aave V3ëŠ” ëŒ€ì¶œë„ <strong>í† í°í™”</strong>í–ˆë‹¤:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=c1>// Aave V3
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>variableDebtToken</span><span class=p>.</span><span class=n>mint</span><span class=p>(</span><span class=n>borrower</span><span class=p>,</span> <span class=n>amount</span><span class=p>);</span>  <span class=c1>// ëŒ€ì¶œí•˜ë©´ ë¶€ì±„ í† í° ë°œí–‰
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>variableDebtToken</span><span class=p>.</span><span class=n>burn</span><span class=p>(</span><span class=n>borrower</span><span class=p>,</span> <span class=n>amount</span><span class=p>);</span>  <span class=c1>// ìƒí™˜í•˜ë©´ ë¶€ì±„ í† í° ì†Œê°
</span></span></span></code></pre></td></tr></table></div></div><p>ë¶€ì±„ë¥¼ í† í°í™”í•˜ë©´ ë¬´ì—‡ì´ ì¢‹ì€ê°€?</p><ul><li><code>balanceOf()</code>ë¡œ ëŒ€ì¶œ ì”ì•¡ ì¡°íšŒ ê°€ëŠ¥ (í‘œì¤€ ì¸í„°í˜ì´ìŠ¤)</li><li>Transfer ì œí•œìœ¼ë¡œ ë¶€ì±„ ì´ì „ ë°©ì§€</li><li>ì´ë²¤íŠ¸ í‘œì¤€í™” (Transfer ì´ë²¤íŠ¸ë¡œ ëŒ€ì¶œ/ìƒí™˜ ì¶”ì  ê°€ëŠ¥)</li></ul><blockquote><p>Aave V3.2ë¶€í„° Stable Rateì´ ì œê±°ë˜ì—ˆë‹¤. ë³€ë™ê¸ˆë¦¬ë§Œ ë‚¨ì•˜ìœ¼ë¯€ë¡œ <code>stableDebtToken</code>ì€ ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤.</p></blockquote><hr><h2 id=ë¹„íŠ¸ë§µ-ìŠ¤í† ë¦¬ì§€-ìµœì í™”>ë¹„íŠ¸ë§µ ìŠ¤í† ë¦¬ì§€ ìµœì í™”</h2><p>Day 2ì˜ ê°€ì¥ ì¤‘ìš”í•œ ê¸°ìˆ ì  ë°œê²¬ì´ë‹¤. Compound V2ì™€ Aave V3ì˜ <strong>ì‚¬ìš©ì ìƒíƒœ ê´€ë¦¬ ë°©ì‹</strong>ì´ ê·¼ë³¸ì ìœ¼ë¡œ ë‹¤ë¥´ë‹¤.</p><h3 id=compound-v2-ë°°ì—´-ìˆœíšŒ>Compound V2: ë°°ì—´ ìˆœíšŒ</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=c1>// Comptroller.sol
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>mapping</span><span class=p>(</span><span class=kt>address</span> <span class=o>=&gt;</span> <span class=n>CToken</span><span class=p>[])</span> <span class=k>public</span> <span class=n>accountAssets</span><span class=p>;</span>  <span class=c1>// ì‚¬ìš©ìë³„ ì°¸ì—¬ ë§ˆì¼“ ë°°ì—´
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Health Factor ê³„ì‚° ì‹œ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>for</span> <span class=p>(</span><span class=kt>uint</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>assets</span><span class=p>.</span><span class=n>length</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ëª¨ë“  ë§ˆì¼“ì„ ìˆœíšŒí•˜ë©° ë‹´ë³´ ê°€ì¹˜ í•©ì‚°
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ë¬¸ì œ: ì‚¬ìš©ìê°€ ì°¸ì—¬í•œ ë§ˆì¼“ì´ ë§ì„ìˆ˜ë¡ <strong>ê°€ìŠ¤ë¹„ê°€ ì„ í˜•ìœ¼ë¡œ ì¦ê°€</strong>í•œë‹¤.</p><h3 id=aave-v3-ë¹„íŠ¸ë§µ>Aave V3: ë¹„íŠ¸ë§µ</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=c1>// í•˜ë‚˜ì˜ uint256ì— 128ê°œ ìì‚°ì˜ ìƒíƒœë¥¼ ë‹´ëŠ”ë‹¤
</span></span></span><span class=line><span class=cl><span class=c1>// ê° ìì‚°ì´ 2ë¹„íŠ¸ë¥¼ ì°¨ì§€: [ë‹´ë³´ ì‚¬ìš© ì—¬ë¶€][ëŒ€ì¶œ ì—¬ë¶€]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>mapping</span><span class=p>(</span><span class=kt>address</span> <span class=o>=&gt;</span> <span class=n>UserConfigurationMap</span><span class=p>)</span> <span class=k>internal</span> <span class=n>_usersConfig</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>struct</span> <span class=nc>UserConfigurationMap</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint256</span> <span class=nb>data</span><span class=p>;</span>  <span class=c1>// 256ë¹„íŠ¸ = 128ê°œ ìì‚° Ã— 2ë¹„íŠ¸
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ë¹„íŠ¸ë§µì˜ êµ¬ì¡°:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ë¹„íŠ¸ ìœ„ì¹˜:  ... | 5 | 4 | 3 | 2 | 1 | 0 |
</span></span><span class=line><span class=cl>ìì‚° ID:        |  2  |  1  |  0  |
</span></span><span class=line><span class=cl>ì˜ë¯¸:       ... | C | B | C | B | C | B |
</span></span><span class=line><span class=cl>                  B = Borrowing (ëŒ€ì¶œ ì¤‘)
</span></span><span class=line><span class=cl>                  C = Collateral (ë‹´ë³´ë¡œ ì‚¬ìš© ì¤‘)
</span></span></code></pre></td></tr></table></div></div><p>Health Factor ê³„ì‚° ì‹œ:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=c1>// ë¹„íŠ¸ë§µì—ì„œ í•´ë‹¹ ë¹„íŠ¸ê°€ 0ì´ë©´ ìŠ¤í‚µ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=n>userConfig</span><span class=p>.</span><span class=nb>data</span> <span class=o>&amp;</span> <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=p>(</span><span class=n>reserveIndex</span> <span class=o>*</span> <span class=mi>2</span><span class=p>))</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>continue</span><span class=p>;</span>  <span class=c1>// ì´ ìì‚°ì€ ëŒ€ì¶œë„ ë‹´ë³´ë„ ì•„ë‹˜ â†’ O(1)ë¡œ ìŠ¤í‚µ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=ì„±ëŠ¥-ë¹„êµ>ì„±ëŠ¥ ë¹„êµ</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Compound V2 (ë°°ì—´):
</span></span><span class=line><span class=cl>  10ê°œ ë§ˆì¼“ ì°¸ì—¬ â†’ 10ë²ˆ SLOAD + ë£¨í”„ = ~50,000 gas
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Aave V3 (ë¹„íŠ¸ë§µ):
</span></span><span class=line><span class=cl>  128ê°œ ë§ˆì¼“ í™•ì¸ â†’ 1ë²ˆ SLOAD + ë¹„íŠ¸ ì—°ì‚° = ~2,100 gas
</span></span></code></pre></td></tr></table></div></div><p>ë¹„íŠ¸ ì—°ì‚°(<code>AND</code>, <code>SHIFT</code>)ì€ 3 gasë‹¤. 128ê°œ ìì‚°ì„ í™•ì¸í•´ë„ <code>2,100 + 128 Ã— 3 = 2,484 gas</code>. ë°°ì—´ ë°©ì‹ ëŒ€ë¹„ <strong>ì•½ 20ë°° ì ˆì•½</strong>ì´ë‹¤.</p><p>ì´ ì°¨ì´ê°€ ê²°ì •ì ì¸ ì´ìœ : Health Factor ê³„ì‚°ì€ <strong>ëª¨ë“  íŠ¸ëœì­ì…˜ì—ì„œ ë°œìƒ</strong>í•œë‹¤. supply, borrow, repay, liquidate ì „ë¶€. ê°€ì¥ ë¹ˆë²ˆí•˜ê²Œ í˜¸ì¶œë˜ëŠ” ë¡œì§ì˜ ê°€ìŠ¤ë¥¼ 20ë°° ì¤„ì´ë©´ í”„ë¡œí† ì½œ ì „ì²´ì˜ ê°€ìŠ¤ íš¨ìœ¨ì´ ê·¹ì ìœ¼ë¡œ ê°œì„ ëœë‹¤.</p><hr><h2 id=lendingpool-ë¦¬íŒ©í† ë§-ë°°ìš´-ê²ƒì„-ì ìš©í•˜ê¸°>LendingPool ë¦¬íŒ©í† ë§: ë°°ìš´ ê²ƒì„ ì ìš©í•˜ê¸°</h2><p>ìŠ¤í„°ë”” í”„ë¡œì íŠ¸ì˜ <code>LendingPool.sol</code>ì— Aave V3ì˜ PoolStorage íŒ¨í„´ì„ ì ìš©í–ˆë‹¤.</p><h3 id=before-ë‹¨ìˆœ-ë§¤í•‘>Before: ë‹¨ìˆœ ë§¤í•‘</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=kd>mapping</span><span class=p>(</span><span class=kt>address</span> <span class=o>=&gt;</span> <span class=kd>mapping</span><span class=p>(</span><span class=kt>address</span> <span class=o>=&gt;</span> <span class=kt>uint256</span><span class=p>))</span> <span class=k>public</span> <span class=n>deposits</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>mapping</span><span class=p>(</span><span class=kt>address</span> <span class=o>=&gt;</span> <span class=kd>mapping</span><span class=p>(</span><span class=kt>address</span> <span class=o>=&gt;</span> <span class=kt>uint256</span><span class=p>))</span> <span class=k>public</span> <span class=n>borrows</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=after-êµ¬ì¡°í™”ëœ-ìŠ¤í† ë¦¬ì§€>After: êµ¬ì¡°í™”ëœ ìŠ¤í† ë¦¬ì§€</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=kd>struct</span> <span class=nc>ReserveData</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint128</span> <span class=n>liquidityIndex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint128</span> <span class=n>variableBorrowIndex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint128</span> <span class=n>currentLiquidityRate</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint128</span> <span class=n>currentVariableBorrowRate</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint40</span> <span class=n>lastUpdateTimestamp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint16</span> <span class=n>id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>address</span> <span class=n>aTokenAddress</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>address</span> <span class=n>variableDebtTokenAddress</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint128</span> <span class=n>totalDeposits</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint128</span> <span class=n>totalBorrows</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>mapping</span><span class=p>(</span><span class=kt>address</span> <span class=o>=&gt;</span> <span class=n>ReserveData</span><span class=p>)</span> <span class=k>internal</span> <span class=n>_reserves</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>mapping</span><span class=p>(</span><span class=kt>uint256</span> <span class=o>=&gt;</span> <span class=kt>address</span><span class=p>)</span> <span class=k>internal</span> <span class=n>_reservesList</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>uint16</span> <span class=k>internal</span> <span class=n>_reservesCount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>mapping</span><span class=p>(</span><span class=kt>address</span> <span class=o>=&gt;</span> <span class=n>UserConfigurationMap</span><span class=p>)</span> <span class=k>internal</span> <span class=n>_usersConfig</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>í•µì‹¬ ë³€ê²½ì :</p><ul><li><code>_reserves</code>: ìì‚° ì£¼ì†Œ â†’ ReserveData ë§¤í•‘ (ëª¨ë“  ìì‚° ìƒíƒœë¥¼ í•˜ë‚˜ì˜ êµ¬ì¡°ì²´ë¡œ)</li><li><code>_reservesList</code>: reserveId â†’ ìì‚° ì£¼ì†Œ ë§¤í•‘ (ë¹„íŠ¸ë§µ ì¸ë±ì‹±ìš©)</li><li><code>_usersConfig</code>: ì‚¬ìš©ìë³„ ë¹„íŠ¸ë§µ (ë‹´ë³´/ëŒ€ì¶œ ìƒíƒœ)</li></ul><p>ë¹„íŠ¸ë§µ í—¬í¼ë„ êµ¬í˜„í–ˆë‹¤:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=kd>function</span> <span class=nf>isUsingAsCollateral</span><span class=p>(</span><span class=n>UserConfigurationMap</span> <span class=k>memory</span> <span class=n>self</span><span class=p>,</span> <span class=kt>uint256</span> <span class=n>reserveIndex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>internal</span> <span class=k>pure</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>bool</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=n>self</span><span class=p>.</span><span class=nb>data</span> <span class=o>&gt;&gt;</span> <span class=p>(</span><span class=n>reserveIndex</span> <span class=o>*</span> <span class=mi>2</span> <span class=o>+</span> <span class=mi>1</span><span class=p>))</span> <span class=o>&amp;</span> <span class=mi>1</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nf>isBorrowing</span><span class=p>(</span><span class=n>UserConfigurationMap</span> <span class=k>memory</span> <span class=n>self</span><span class=p>,</span> <span class=kt>uint256</span> <span class=n>reserveIndex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>internal</span> <span class=k>pure</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>bool</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=n>self</span><span class=p>.</span><span class=nb>data</span> <span class=o>&gt;&gt;</span> <span class=p>(</span><span class=n>reserveIndex</span> <span class=o>*</span> <span class=mi>2</span><span class=p>))</span> <span class=o>&amp;</span> <span class=mi>1</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ë¦¬íŒ©í† ë§ í›„ ëª¨ë“  62ê°œ í…ŒìŠ¤íŠ¸(ê¸°ì¡´ 61 + ë¹„íŠ¸ë§µ í…ŒìŠ¤íŠ¸ 1)ê°€ í†µê³¼í–ˆë‹¤.</p><hr><h2 id=jumpratemodel-í…ŒìŠ¤íŠ¸-fuzz-testingê¹Œì§€>JumpRateModel í…ŒìŠ¤íŠ¸: Fuzz Testingê¹Œì§€</h2><p>Day 1ì—ì„œ ì´ë¡ ìœ¼ë¡œ ë‹¤ë£¬ JumpRateModelì„ ì‹¤ì œë¡œ êµ¬í˜„í•˜ê³  í…ŒìŠ¤íŠ¸í–ˆë‹¤.</p><h3 id=unit-test-18ê°œ-ì¼€ì´ìŠ¤>Unit Test: 18ê°œ ì¼€ì´ìŠ¤</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[PASS] testGetBorrowRate_ZeroUtilization()
</span></span><span class=line><span class=cl>[PASS] testGetBorrowRate_AtKink()
</span></span><span class=line><span class=cl>[PASS] testGetBorrowRate_AboveKink()
</span></span><span class=line><span class=cl>[PASS] testGetBorrowRate_FullUtilization()
</span></span><span class=line><span class=cl>[PASS] testGetSupplyRate_WithReserveFactor()
</span></span><span class=line><span class=cl>... (18ê°œ ì „ë¶€ í†µê³¼)
</span></span></code></pre></td></tr></table></div></div><h3 id=fuzz-test-6ê°œ-ì¼€ì´ìŠ¤>Fuzz Test: 6ê°œ ì¼€ì´ìŠ¤</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=kd>function</span> <span class=nf>testFuzz_BorrowRateMonotonicity</span><span class=p>(</span><span class=kt>uint256</span> <span class=n>util1</span><span class=p>,</span> <span class=kt>uint256</span> <span class=n>util2</span><span class=p>)</span> <span class=k>public</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>util1</span> <span class=o>=</span> <span class=n>bound</span><span class=p>(</span><span class=n>util1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=n>e18</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>util2</span> <span class=o>=</span> <span class=n>bound</span><span class=p>(</span><span class=n>util2</span><span class=p>,</span> <span class=n>util1</span><span class=p>,</span> <span class=mi>1</span><span class=n>e18</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>uint256</span> <span class=n>rate1</span> <span class=o>=</span> <span class=n>model</span><span class=p>.</span><span class=n>getBorrowRate</span><span class=p>(</span><span class=n>cash1</span><span class=p>,</span> <span class=n>borrows1</span><span class=p>,</span> <span class=n>reserves1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint256</span> <span class=n>rate2</span> <span class=o>=</span> <span class=n>model</span><span class=p>.</span><span class=n>getBorrowRate</span><span class=p>(</span><span class=n>cash2</span><span class=p>,</span> <span class=n>borrows2</span><span class=p>,</span> <span class=n>reserves2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>assertGe</span><span class=p>(</span><span class=n>rate2</span><span class=p>,</span> <span class=n>rate1</span><span class=p>);</span>  <span class=c1>// ì‚¬ìš©ë¥ ì´ ë†’ìœ¼ë©´ ì´ììœ¨ë„ ë†’ì•„ì•¼ í•œë‹¤
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Fuzz Testingìœ¼ë¡œ ê²€ì¦í•œ ë¶ˆë³€ ì¡°ê±´:</p><ul><li><strong>ë‹¨ì¡° ì¦ê°€</strong>: ì‚¬ìš©ë¥ ì´ ì˜¬ë¼ê°€ë©´ ì´ììœ¨ë„ ì˜¬ë¼ê°„ë‹¤</li><li><strong>Supply â‰¤ Borrow</strong>: Supply Rateì€ í•­ìƒ Borrow Rate ì´í•˜</li><li><strong>Kinkì—ì„œì˜ ì—°ì†ì„±</strong>: kink ì „í›„ë¡œ ì´ììœ¨ì´ ë¹„ì—°ì†ì ìœ¼ë¡œ ë›°ì§€ ì•ŠëŠ”ë‹¤</li></ul><p>ì „ì²´ 24ê°œ í…ŒìŠ¤íŠ¸ (18 unit + 6 fuzz) ëª¨ë‘ í†µê³¼.</p><hr><h2 id=day-2-í•µì‹¬-ì¸ì‚¬ì´íŠ¸-ì •ë¦¬>Day 2 í•µì‹¬ ì¸ì‚¬ì´íŠ¸ ì •ë¦¬</h2><ol><li><p><strong>Fresh íŒ¨í„´ì€ ë Œë”©ì˜ ì •í•©ì„±ì„ ë³´ì¥í•œë‹¤</strong> - ì´ìë¥¼ ë¨¼ì € ì •ì‚°í•˜ì§€ ì•Šìœ¼ë©´ êµí™˜ë¹„ìœ¨ì´ ë¶€ì •í™•í•´ì ¸ì„œ ê¸°ì¡´ ì‚¬ìš©ìê°€ ì†í•´ë³¸ë‹¤. &ldquo;ì´ìë¶€í„°, ê·¸ ë‹¤ìŒ ë³¸ë¡ "ì´ ì›ì¹™.</p></li><li><p><strong>Lazy Interest Accrualì€ ê°€ìŠ¤ íš¨ìœ¨ì˜ í•µì‹¬</strong> - ë§¤ ë¸”ë¡ì´ ì•„ë‹ˆë¼ íŠ¸ëœì­ì…˜ì´ ë°œìƒí•  ë•Œë§Œ ì´ìë¥¼ ê³„ì‚°í•œë‹¤. 4ê°œì˜ SSTOREë¡œ ì „ì²´ ì‚¬ìš©ìì˜ ì´ìë¥¼ í•œë²ˆì— ì •ì‚°.</p></li><li><p><strong>ë Œë”©ì€ 3ê°€ì§€ ìœ í˜•</strong> - Pool-based(ì˜ˆì¹˜ê¸ˆì—ì„œ ë¹Œë¦¼), CDP-based(ìƒˆ í† í° ë°œí–‰), Fixed-rate(í• ì¸ í† í°). ëŒ€ë¶€ë¶„ì´ Pool-basedì¸ ì´ìœ ëŠ” êµ¬í˜„ ë‹¨ìˆœì„±ê³¼ ìœ ë™ì„± í˜•ì„±ì˜ ìš©ì´í•¨.</p></li><li><p><strong>ë¹„íŠ¸ë§µì´ ì•„í‚¤í…ì²˜ë¥¼ ê²°ì •í•œë‹¤</strong> - Compoundì˜ ë°°ì—´ vs Aaveì˜ ë¹„íŠ¸ë§µ. í•œ ë²ˆì˜ SLOADë¡œ 128ê°œ ìì‚° ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” ê²ƒì€ ë‹¨ìˆœí•œ ìµœì í™”ê°€ ì•„ë‹ˆë¼, Health Factor ê³„ì‚°ì´ ëª¨ë“  íŠ¸ëœì­ì…˜ì—ì„œ ë°œìƒí•˜ê¸° ë•Œë¬¸ì— <strong>í”„ë¡œí† ì½œ ì „ì²´ ê°€ìŠ¤ íš¨ìœ¨</strong>ì„ ì¢Œìš°í•œë‹¤.</p></li><li><p><strong>Storage ë ˆì´ì•„ì›ƒì´ ì•„í‚¤í…ì²˜ë¥¼ ê²°ì •í•œë‹¤</strong> - CompoundëŠ” ë°°ì—´ ì¤‘ì‹¬ì´ë¼ Monolithicì´ ìì—°ìŠ¤ëŸ½ê³ , AaveëŠ” ë¹„íŠ¸ë§µ + êµ¬ì¡°ì²´ ì¤‘ì‹¬ì´ë¼ Modularê°€ ìì—°ìŠ¤ëŸ½ë‹¤. ë°ì´í„° êµ¬ì¡°ê°€ ì½”ë“œ êµ¬ì¡°ë¥¼ ê²°ì •í•œë‹¤.</p></li></ol><hr><h2 id=next-day-3>Next: Day 3</h2><p>ë‚´ì¼ì€ <strong>ì²­ì‚°(Liquidation) ë©”ì»¤ë‹ˆì¦˜</strong>ì„ íŒŒê³ ë“ ë‹¤.</p><ul><li>ì²­ì‚° íŠ¸ë¦¬ê±° ì¡°ê±´ê³¼ <code>liquidateBorrowFresh()</code> ì½”ë“œ ë¦¬ë”©</li><li>ì²­ì‚° ë³´ë„ˆìŠ¤(Liquidation Incentive) ê²½ì œí•™</li><li>Foundry Fork Testingìœ¼ë¡œ Aave V3 ë©”ì¸ë„· ì²­ì‚° ì‹œë®¬ë ˆì´ì…˜</li><li>ê³ ê¸‰ Foundry í…ŒìŠ¤íŒ… íŒ¨í„´ (invariant, fork)</li></ul><hr><p><em>ì´ ì‹œë¦¬ì¦ˆì˜ ì „ì²´ ì½”ë“œì™€ í•™ìŠµ ìë£ŒëŠ” <a class=link href=https://github.com/jeongseup/lending-protocol-study target=_blank rel=noopener>lending-protocol-study</a> ë ˆí¬ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</em></p></section><footer class=article-footer><section class=article-tags><a href=/tags/defi/>DeFi</a>
<a href=/tags/lending/>Lending</a>
<a href=/tags/compound/>Compound</a>
<a href=/tags/aave/>Aave</a>
<a href=/tags/solidity/>Solidity</a>
<a href=/tags/smart-contract/>Smart Contract</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{const e=[".main-article",".widget--toc"];e.forEach(e=>{const t=document.querySelector(e);t&&renderMathInElement(t,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})})</script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/lending-protocol-study-day1/><div class=article-details><h2 class=article-title>Lending Protocol Study Day 1: DeFi ë Œë”©ì˜ í•µì‹¬ ê°œë…ê³¼ ì•„í‚¤í…ì²˜</h2></div></a></article><article><a href=/p/evm-integer-only-design/><div class=article-details><h2 class=article-title>EVMì€ ì™œ ì •ìˆ˜(uint)ë§Œ ì§€ì›í•˜ëŠ”ê°€?</h2></div></a></article><article><a href=/research/2026-01-03-validator-reward-deep-dive/><div class=article-details><h2 class=article-title>Validator Reward Deep Dive Series</h2></div></a></article><article><a href=/research/2026-01-03-validator-reward-deep-dive.ko/><div class=article-details><h2 class=article-title>Validator Reward Deep Dive Series</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo=jeongseup/jeongseup.github.io data-repo-id=R_kgDOQn-FSg data-category=Announcements data-category-id=DIC_kwDOQn-FSs4C1AgN data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark")}})()</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2026 Jeongseup Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.34.2>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>