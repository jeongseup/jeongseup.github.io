<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="7일간의 DeFi Lending Protocol 스터디 시리즈. 풀 기반 중개, Share-Based Accounting, Scaled Balance 가스 최적화, Compound vs Aave 아키텍처까지."><title>Lending Protocol Study Day 1: DeFi 렌딩의 핵심 개념과 아키텍처</title><link rel=canonical href=https://jeongseup.github.io/p/lending-protocol-study-day1/><link rel=stylesheet href=/scss/style.min.86591c898bd806857815fbb8c47e8d3fed97c133b78e83d9bfc27b164dd0aa2b.css><meta property='og:title' content="Lending Protocol Study Day 1: DeFi 렌딩의 핵심 개념과 아키텍처"><meta property='og:description' content="7일간의 DeFi Lending Protocol 스터디 시리즈. 풀 기반 중개, Share-Based Accounting, Scaled Balance 가스 최적화, Compound vs Aave 아키텍처까지."><meta property='og:url' content='https://jeongseup.github.io/p/lending-protocol-study-day1/'><meta property='og:site_name' content='Jeongseup Blog'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='DeFi'><meta property='article:tag' content='Lending'><meta property='article:tag' content='Compound'><meta property='article:tag' content='Aave'><meta property='article:tag' content='Solidity'><meta property='article:tag' content='Smart Contract'><meta property='article:published_time' content='2026-02-23T00:00:00+00:00'><meta property='article:modified_time' content='2026-02-23T00:00:00+00:00'><meta name=twitter:site content="@@jeongseup"><meta name=twitter:creator content="@@jeongseup"><meta name=twitter:title content="Lending Protocol Study Day 1: DeFi 렌딩의 핵심 개념과 아키텍처"><meta name=twitter:description content="7일간의 DeFi Lending Protocol 스터디 시리즈. 풀 기반 중개, Share-Based Accounting, Scaled Balance 가스 최적화, Compound vs Aave 아키텍처까지."><link rel="shortcut icon" href=/favicon.png><script async src="https://www.googletagmanager.com/gtag/js?id=G-H52JV5SRGP"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-H52JV5SRGP")</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_4265f78095175e3e.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>👨‍💻</span></figure><div class=site-meta><h1 class=site-name><a href=/>Jeongseup Blog</a></h1><h2 class=site-description>Software Engineer (DevOps & Solution Engineer)</h2></div></header><ol class=menu-social><li><a href=https://warpcast.com/cosmoseup target=_blank title=Farcaster rel=me><svg class="icon icon-tabler icon-tabler-cube" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M21 16.008V7.99a1.98 1.98.0 00-1-1.717l-7-4.008a2.016 2.016.0 00-2 0L4 6.273c-.619.355-1 1.01-1 1.718v8.018c0 .709.381 1.363 1 1.717l7 4.008a2.016 2.016.0 002 0l7-4.008c.619-.355 1-1.01 1-1.718z"/><path d="M12 22V12"/><path d="M12 12l8.73-5.04"/><path d="M3.27 6.96 12 12"/></svg></a></li><li><a href=https://github.com/jeongseup/ target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/jeongseup/ target=_blank title=LinkedIn rel=me><svg class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li><li><a href=https://medium.com/@jeongseup target=_blank title=Medium rel=me><svg class="icon icon-tabler icon-tabler-brand-medium" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 9h1l3 3 3-3h1"/><path d="M8 15h2"/><path d="M14 15h2"/><path d="M9 9v6"/><path d="M15 9v6"/></svg></a></li><li><a href=https://t.me/jeongseup target=_blank title=Telegram rel=me><svg class="icon icon-tabler icon-tabler-brand-telegram" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 10l-4 4 6 6 4-16-18 7 4 2 2 6 3-4"/></svg></a></li><li><a href=https://x.com/jeongseup target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4l11.733 16H20L8.267 4z"/><path d="M4 20l6.768-6.768m2.46-2.46L20 4"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 7a4 4 0 108 0A4 4 0 008 7"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/project/><svg class="icon icon-tabler icon-tabler-code" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 8l-4 4 4 4"/><path d="M17 8l4 4-4 4"/><path d="M14 4l-4 16"/></svg>
<span>Projects</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/contribution/><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg>
<span>Open Source</span></a></li><li><a href=/research/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="M7 9a2 2 0 104 0A2 2 0 107 9"/><path d="M17 7a2 2 0 104 0 2 2 0 10-4 0"/><path d="M12 15a2 2 0 104 0 2 2 0 10-4 0"/><path d="M10.16 10.62l2.34 2.88"/><path d="M15.088 13.328l2.837-4.586"/></svg>
<span>Technical Research</span></a></li><li><a href=/contact/><svg class="icon icon-tabler icon-tabler-mail" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/><path d="M3 7l9 6 9-6"/></svg>
<span>Contact Me</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#why-lending-protocol>Why Lending Protocol?</a></li><li><a href=#렌딩-프로토콜의-본질-풀-기반-중개>렌딩 프로토콜의 본질: 풀 기반 중개</a></li><li><a href=#렌딩의-5대-핵심-파라미터>렌딩의 5대 핵심 파라미터</a><ol><li><a href=#외워야-할-공식-3개>외워야 할 공식 3개</a></li></ol></li><li><a href=#이자율-모델-jump-rate-model>이자율 모델: Jump Rate Model</a></li><li><a href=#ctoken-vs-atoken-이자를-반영하는-두-가지-방법>cToken vs aToken: 이자를 반영하는 두 가지 방법</a><ol><li><a href=#compound의-ctoken-교환비율-상승>Compound의 cToken: 교환비율 상승</a></li><li><a href=#aave의-atoken-잔고-자동-증가-rebase>Aave의 aToken: 잔고 자동 증가 (Rebase)</a></li></ol></li><li><a href=#share-based-accounting-defi의-범용-패턴>Share-Based Accounting: DeFi의 범용 패턴</a></li><li><a href=#가스-최적화의-핵심-scaled-balance>가스 최적화의 핵심: Scaled Balance</a></li><li><a href=#compound-v2-vs-aave-v3-아키텍처-차이>Compound V2 vs Aave V3: 아키텍처 차이</a><ol><li><a href=#compound-v2-코드-리딩-가이드>Compound V2 코드 리딩 가이드</a></li></ol></li><li><a href=#이자율의-3개-레이어>이자율의 3개 레이어</a></li><li><a href=#day-1-핵심-인사이트-정리>Day 1 핵심 인사이트 정리</a></li><li><a href=#next-day-2>Next: Day 2</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/technical-research/ style=background-color:#8b5cf6;color:#fff>Technical Research</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/lending-protocol-study-day1/>Lending Protocol Study Day 1: DeFi 렌딩의 핵심 개념과 아키텍처</a></h2><h3 class=article-subtitle>7일간의 DeFi Lending Protocol 스터디 시리즈. 풀 기반 중개, Share-Based Accounting, Scaled Balance 가스 최적화, Compound vs Aave 아키텍처까지.</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2026-02-23T00:00:00Z>Feb 23, 2026</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>6 minute read</time></div></footer></div></header><section class=article-content><blockquote><p>7일간의 DeFi Lending Protocol 스터디 시리즈. 백엔드/인프라 엔지니어 관점에서 렌딩 프로토콜을 코드 레벨까지 파헤친다.</p><p><strong>Repository:</strong> <a class=link href=https://github.com/jeongseup/lending-protocol-study target=_blank rel=noopener>jeongseup/lending-protocol-study</a></p></blockquote><hr><h2 id=why-lending-protocol>Why Lending Protocol?</h2><p>블록체인 인프라 엔지니어로 일하면서 노드 운영, 밸리데이터 모니터링, 스테이킹 보상 분석 등을 해왔다. 그런데 DeFi의 가장 큰 축인 <strong>렌딩 프로토콜</strong>은 &ldquo;대충 알겠는데 코드 레벨에서는 모른다"는 상태였다.</p><p>이번 스터디의 목표는 명확하다:</p><ul><li>Compound V2 / Aave V3의 핵심 로직을 <strong>코드로 읽고 구현</strong>한다</li><li>렌딩의 수학적 모델(이자율, 청산, Health Factor)을 <strong>공식 수준</strong>으로 이해한다</li><li>Solidity + Go 모니터링 도구까지 만들어 <strong>실무에 적용 가능한 수준</strong>으로 올린다</li></ul><hr><h2 id=렌딩-프로토콜의-본질-풀-기반-중개>렌딩 프로토콜의 본질: 풀 기반 중개</h2><p>전통 금융의 대출은 대출자와 차입자를 1:1로 매칭한다. DeFi 렌딩은 다르다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>전통 금융:  Alice → [은행] → Bob  (1:1 매칭)
</span></span><span class=line><span class=cl>DeFi 렌딩:  Alice → [Pool] ← Bob  (풀 기반 간접 매칭)
</span></span></code></pre></td></tr></table></div></div><p>예치자들이 자산을 풀에 넣으면, 차입자들이 담보를 걸고 풀에서 빌려간다. <strong>아무도 누가 누구에게 빌려줬는지 모른다.</strong> 이자율은 풀의 사용률(Utilization Rate)에 따라 알고리즘이 자동으로 결정한다.</p><p>이 구조의 핵심 이유는 간단하다:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>블록체인 = 익명 → 신용평가 불가 → 담보로만 판단 → 과담보 필수
</span></span></code></pre></td></tr></table></div></div><p>신용이 없으니 담보로 대체한다. 그래서 DeFi 렌딩은 태생적으로 <strong>과담보(Over-collateralized)</strong> 구조다.</p><hr><h2 id=렌딩의-5대-핵심-파라미터>렌딩의 5대 핵심 파라미터</h2><p>렌딩 프로토콜을 이해하려면 이 5가지 숫자만 확실히 알면 된다.</p><div class=table-wrapper><table><thead><tr><th>파라미터</th><th>의미</th><th>일반적 범위</th></tr></thead><tbody><tr><td><strong>LTV</strong> (Loan-to-Value)</td><td>담보 대비 얼마까지 빌릴 수 있나</td><td>75-80%</td></tr><tr><td><strong>Health Factor</strong></td><td>내 포지션이 안전한가 (&lt; 1이면 청산)</td><td>1.0 이상 유지</td></tr><tr><td><strong>Utilization Rate</strong></td><td>풀의 자금 중 얼마가 빌려졌나</td><td>이자율 결정</td></tr><tr><td><strong>Reserve Factor</strong></td><td>프로토콜이 이자에서 떼가는 비율</td><td>10-35%</td></tr><tr><td><strong>Collateral Factor</strong></td><td>자산의 담보 가치 인정 비율</td><td>자산마다 다름</td></tr></tbody></table></div><h3 id=외워야-할-공식-3개>외워야 할 공식 3개</h3>$$HF = \frac{LT}{LTV}$$$$\text{최대 허용 하락률} = 1 - \frac{LTV}{LT}$$$$\text{Supply APY} = \text{Borrow APR} \times \text{Utilization} \times (1 - \text{Reserve Factor})$$<p>세 번째 공식이 특히 중요하다. Supply APY가 Borrow APR보다 <strong>수학적으로 항상 작은</strong> 이유가 여기 있다. 풀의 돈이 100% 빌려진 게 아니고(Utilization &lt; 1), 프로토콜이 Reserve Factor만큼 떼가기 때문이다.</p><blockquote><p>단, 토큰 인센티브(COMP, AAVE)나 포인트/에어드랍까지 포함하면 역전될 수 있다. 2020년 DeFi Summer에 &ldquo;빌리면 돈 버는&rdquo; 상황이 실제로 발생했다.</p></blockquote><hr><h2 id=이자율-모델-jump-rate-model>이자율 모델: Jump Rate Model</h2><p>&ldquo;사용률이 올라가면 이자율도 올라간다"는 단순한 원칙이지만, 구현 방식은 프로토콜마다 다르다.</p><div class=table-wrapper><table><thead><tr><th>프로토콜</th><th>모델</th><th>특징</th></tr></thead><tbody><tr><td>Compound V2</td><td>Jump Rate Model</td><td>원조. kink 지점에서 이자율 급등</td></tr><tr><td>Aave V3</td><td>Variable Rate Strategy</td><td>비슷하지만 파라미터 구조 다름</td></tr><tr><td>MakerDAO</td><td>거버넌스 직접 설정</td><td>알고리즘 아님</td></tr><tr><td>Euler V2</td><td>모듈형</td><td>풀 생성자가 모델 직접 선택</td></tr></tbody></table></div><p>DEX에서 <code>x * y = k</code> (CPMM)가 원조 모델이듯, 렌딩에서는 Jump Rate Model이 원조다. &ldquo;유일한 표준"은 아니지만, 대부분의 모델이 이걸 변형한 것이다.</p><hr><h2 id=ctoken-vs-atoken-이자를-반영하는-두-가지-방법>cToken vs aToken: 이자를 반영하는 두 가지 방법</h2><p>렌딩에 자산을 예치하면 &ldquo;영수증 토큰"을 받는다. 이 영수증이 이자를 반영하는 방식이 Compound와 Aave에서 근본적으로 다르다.</p><h3 id=compound의-ctoken-교환비율-상승>Compound의 cToken: 교환비율 상승</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>예치: 1,000 USDC → 50,000 cUSDC (교환비율 0.02)
</span></span><span class=line><span class=cl>1년후: 50,000 cUSDC 그대로, 교환비율 0.025로 상승
</span></span><span class=line><span class=cl>인출: 50,000 × 0.025 = 1,250 USDC
</span></span></code></pre></td></tr></table></div></div><p>토큰 수량은 변하지 않고, <strong>교환비율이 올라간다.</strong></p><h3 id=aave의-atoken-잔고-자동-증가-rebase>Aave의 aToken: 잔고 자동 증가 (Rebase)</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>예치: 1,000 USDC → 1,000 aUSDC (1:1)
</span></span><span class=line><span class=cl>1년후: 지갑에 1,050 aUSDC로 자동 증가
</span></span><span class=line><span class=cl>인출: 1,050 aUSDC → 1,050 USDC
</span></span></code></pre></td></tr></table></div></div><p>교환비율은 1:1 고정이고, <strong>토큰 수량이 늘어난다.</strong></p><div class=table-wrapper><table><thead><tr><th>비교</th><th>cToken</th><th>aToken</th></tr></thead><tbody><tr><td>UX</td><td>비직관적 (교환비율 계산 필요)</td><td>직관적 (잔고 = 실제 가치)</td></tr><tr><td>DeFi 호환성</td><td>유리 (표준 ERC20)</td><td>불리 (rebase 토큰)</td></tr><tr><td>수학</td><td><code>amount = shares × exchangeRate</code></td><td><code>balance = scaledBalance × index</code></td></tr></tbody></table></div><p>수학적으로는 동일하다. <strong>&ldquo;언제 곱하느냐"의 차이일 뿐이다.</strong></p><hr><h2 id=share-based-accounting-defi의-범용-패턴>Share-Based Accounting: DeFi의 범용 패턴</h2><p>cToken의 교환비율 패턴은 사실 DeFi 전반에서 반복되는 범용 패턴이다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>지분으로 변환 → 전역 비율만 업데이트 → 인출 시 역변환
</span></span></code></pre></td></tr></table></div></div><p>이 패턴을 쓰는 곳들:</p><div class=table-wrapper><table><thead><tr><th>프로토콜</th><th>용도</th></tr></thead><tbody><tr><td>Compound cToken</td><td>렌딩 예치 영수증</td></tr><tr><td>ERC-4626</td><td>토큰화된 Vault 표준</td></tr><tr><td>Lido wstETH</td><td>Liquid Staking</td></tr><tr><td>Rocket Pool rETH</td><td>Liquid Staking</td></tr><tr><td>Walrus StakingPool</td><td>스토리지 네트워크 스테이킹</td></tr></tbody></table></div><p>Walrus의 <code>StakingPool</code>과 비교하면:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Compound cToken:
</span></span><span class=line><span class=cl>  exchange_rate = (totalCash + totalBorrows - totalReserves) / totalSupply
</span></span><span class=line><span class=cl>  deposit:  shares = amount / exchange_rate
</span></span><span class=line><span class=cl>  withdraw: amount = shares × exchange_rate
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Walrus StakingPool:
</span></span><span class=line><span class=cl>  exchange_rate = total_wal / total_shares
</span></span><span class=line><span class=cl>  stake:    shares = principal × total_shares / total_wal
</span></span><span class=line><span class=cl>  withdraw: amount = shares × total_wal / total_shares
</span></span></code></pre></td></tr></table></div></div><p><strong>같은 공식이다. 변수명만 다르다.</strong></p><hr><h2 id=가스-최적화의-핵심-scaled-balance>가스 최적화의 핵심: Scaled Balance</h2><p>aToken이 &ldquo;잔고가 자동으로 늘어난다"면, 매번 모든 사용자의 잔고를 업데이트하는 걸까? 당연히 아니다. 그러면 가스비가 폭발한다.</p><p>핵심 아이디어: <strong>쓰기를 읽기로 바꾼다.</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Scaled Balance = 예치금 / 예치 시점의 liquidityIndex
</span></span></code></pre></td></tr></table></div></div><p>이 값은 한번 저장되면 <strong>절대 변하지 않는다.</strong> 변하는 건 전역 <code>liquidityIndex</code> 하나뿐이다.</p><p>잔고를 조회할 때 <code>scaledBalance × 현재 index</code>로 계산한다. <code>balanceOf()</code>는 view 함수이므로 가스비가 0이다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>순진한 방식: 이자 발생 시 모든 사용자 잔고 SSTORE
</span></span><span class=line><span class=cl>  → 1,000명 × 5,000 gas = 5,000,000 gas
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Scaled Balance: 전역 index 1개만 SSTORE
</span></span><span class=line><span class=cl>  → 5,000 gas
</span></span><span class=line><span class=cl>  → 99.9% 절약
</span></span></code></pre></td></tr></table></div></div><p>EVM에서 <code>SSTORE</code>(쓰기)는 5,000 gas, <code>MUL</code>(곱셈)은 5 gas다. <strong>쓰기는 계산보다 1,000배 비싸다.</strong> Merkle Patricia Trie를 재계산하고 모든 노드에 영구 저장해야 하기 때문이다. Scaled Balance는 이 비용 구조를 정확히 활용한 최적화다.</p><hr><h2 id=compound-v2-vs-aave-v3-아키텍처-차이>Compound V2 vs Aave V3: 아키텍처 차이</h2><p>두 프로토콜의 가장 큰 차이는 코드 구조에 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Compound: CToken이 풀 역할까지 겸함 (Monolithic)
</span></span><span class=line><span class=cl>  사용자 → CToken.mint()
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Aave/우리 프로젝트: Pool과 토큰 분리 (Modular)
</span></span><span class=line><span class=cl>  사용자 → Pool.deposit() → aToken.mint()
</span></span></code></pre></td></tr></table></div></div><p>Compound의 CToken은 ERC20 토큰이면서 동시에 렌딩 풀이다. <code>mint()</code>, <code>borrow()</code>, <code>repay()</code>, <code>liquidate()</code> 모두 CToken 컨트랙트에 있다. 반면 Aave는 Pool이 중심이고 aToken은 순수한 영수증 토큰이다.</p><h3 id=compound-v2-코드-리딩-가이드>Compound V2 코드 리딩 가이드</h3><p>Compound V2 코드를 읽고 싶다면, 핵심 <strong>3개 파일, 5개 함수</strong>만 보면 된다.</p><p><strong>CToken.sol</strong> - 핵심 함수 5개:</p><ul><li><code>accrueInterest()</code> - 이자 누적 (borrowIndex = scaled balance 패턴)</li><li><code>mintFresh()</code> - 예치</li><li><code>borrowFresh()</code> - 대출</li><li><code>repayBorrowFresh()</code> - 상환</li><li><code>liquidateBorrowFresh()</code> - 청산</li></ul><p><strong>Comptroller.sol</strong> - 핵심 함수 1개:</p><ul><li><code>getHypotheticalAccountLiquidityInternal()</code> - Health Factor 계산</li></ul><p><strong>BaseJumpRateModelV2.sol</strong> - 이자율 모델</p><p>나머지(Governance, Lens, Timelock 등)는 렌딩 로직과 무관하므로 무시해도 된다.</p><hr><h2 id=이자율의-3개-레이어>이자율의 3개 레이어</h2><p>DeFi에서 실제 수익률은 단순한 이자율이 아니라 3개 레이어의 합이다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Layer 1: 기본 이자        → Jump Rate Model이 결정
</span></span><span class=line><span class=cl>Layer 2: 토큰 인센티브    → COMP, AAVE 등 거버넌스 토큰 보상
</span></span><span class=line><span class=cl>Layer 3: 포인트/에어드랍  → Blast, EigenLayer 등
</span></span></code></pre></td></tr></table></div></div><p>Layer 2, 3까지 포함하면 &ldquo;빌리면 돈 버는&rdquo; 상황도 발생한다. 2020 DeFi Summer에 COMP 보상이 대출 이자보다 커서 Compound에서 빌리는 것 자체가 수익이었던 것이 대표적인 사례다.</p><hr><h2 id=day-1-핵심-인사이트-정리>Day 1 핵심 인사이트 정리</h2><ol><li><p><strong>렌딩의 본질은 풀 기반 중개</strong> - 예치자와 대출자를 직접 매칭하지 않고, 풀을 통해 간접 매칭한다. 스테이킹 풀과 동일한 패턴.</p></li><li><p><strong>Share-Based Accounting은 DeFi의 범용 패턴</strong> - cToken, ERC-4626, wstETH, rETH, Walrus 전부 같은 원리. &ldquo;지분으로 변환 → 전역 비율만 업데이트 → 인출 시 역변환.&rdquo;</p></li><li><p><strong>가스 최적화의 핵심은 &ldquo;쓰기를 읽기로 바꾸기&rdquo;</strong> - SSTORE는 계산보다 1,000배 비싸다. Scaled Balance 패턴으로 전역 index 하나만 업데이트하고 나머지는 읽기 시점에 계산.</p></li><li><p><strong>Compound는 Monolithic, Aave는 Modular</strong> - CToken이 풀 겸 토큰 vs Pool과 토큰 분리.</p></li><li><p><strong>실제 수익률 = 기본 이자 + 토큰 인센티브 + 포인트</strong> - 3개 레이어를 모두 봐야 DeFi의 실제 경제를 이해할 수 있다.</p></li></ol><hr><h2 id=next-day-2>Next: Day 2</h2><p>내일은 <strong>Aave V3 아키텍처를 코드 레벨로</strong> 들어간다.</p><ul><li><code>Pool.sol</code>, <code>SupplyLogic.sol</code>, <code>BorrowLogic.sol</code>, <code>LiquidationLogic.sol</code> 리딩</li><li>Fork Testing으로 Aave V3 메인넷 상태에서 직접 테스트</li><li>Fuzz Testing으로 이자율 엣지 케이스 탐색</li></ul><hr><p><em>이 시리즈의 전체 코드와 학습 자료는 <a class=link href=https://github.com/jeongseup/lending-protocol-study target=_blank rel=noopener>lending-protocol-study</a> 레포에서 확인할 수 있다.</em></p></section><footer class=article-footer><section class=article-tags><a href=/tags/defi/>DeFi</a>
<a href=/tags/lending/>Lending</a>
<a href=/tags/compound/>Compound</a>
<a href=/tags/aave/>Aave</a>
<a href=/tags/solidity/>Solidity</a>
<a href=/tags/smart-contract/>Smart Contract</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{const e=[".main-article",".widget--toc"];e.forEach(e=>{const t=document.querySelector(e);t&&renderMathInElement(t,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})})</script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/lending-protocol-study-day2/><div class=article-details><h2 class=article-title>Lending Protocol Study Day 2: Compound V2 Deep Dive와 Aave V3 아키텍처</h2></div></a></article><article><a href=/p/evm-integer-only-design/><div class=article-details><h2 class=article-title>EVM은 왜 정수(uint)만 지원하는가?</h2></div></a></article><article><a href=/research/2026-01-03-validator-reward-deep-dive/><div class=article-details><h2 class=article-title>Validator Reward Deep Dive Series</h2></div></a></article><article><a href=/research/2026-01-03-validator-reward-deep-dive.ko/><div class=article-details><h2 class=article-title>Validator Reward Deep Dive Series</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo=jeongseup/jeongseup.github.io data-repo-id=R_kgDOQn-FSg data-category=Announcements data-category-id=DIC_kwDOQn-FSs4C1AgN data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark")}})()</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2026 Jeongseup Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.34.2>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>